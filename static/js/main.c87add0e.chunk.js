(this.webpackJsonpfluidicsviz=this.webpackJsonpfluidicsviz||[]).push([[0],{28:function(e,t,a){e.exports=a(40)},33:function(e,t,a){},37:function(e,t,a){},40:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(21),o=a.n(c),i=a(3),l=a(6),d=a(1),s=a(7),u=a(4),f=(a(33),a(22)),v=function(e){var t=e.value,a=e.row.index,c=e.column,o=c.id,l=(c.width,e.updateMyData),d=Object(n.useState)(t),s=Object(i.a)(d,2),u=s[0],f=s[1];return Object(n.useEffect)((function(){f(t)}),[t]),r.a.createElement("input",{className:o,value:u,onChange:function(e){f(e.target.value),e.stopPropagation()},onBlur:function(){l(a,o,u)}})};function p(e){var t=e.columns,a=e.data,n=e.updateMyData,c=e.skipPageReset,o=Object(f.useTable)({columns:t,data:a,autoResetExpanded:!c,updateMyData:n}),i=o.getTableProps,l=o.getTableBodyProps,d=o.headerGroups,s=o.rows,u=o.prepareRow;return r.a.createElement(r.a.Fragment,null,r.a.createElement("table",i(),r.a.createElement("thead",null,d.map((function(e){return r.a.createElement("tr",e.getHeaderGroupProps(),e.headers.map((function(e){return r.a.createElement("th",Object.assign({width:e.width},e.getHeaderProps()),e.render("Header"))})))}))),r.a.createElement("tbody",l(),s.map((function(e,t){return u(e)||r.a.createElement("tr",e.getRowProps(),e.cells.map((function(e){return r.a.createElement("td",Object.assign({style:{width:"".concat(e.column.width,"px")}},e.getCellProps()),e.render("Cell"))})))})))))}var O,g,m,b=function(e){return r.a.createElement("div",{className:"selectBut",onClick:function(t){e.value.fire("dblclick")}},e.value._memory&&e.value._memory._selectHandler&&e.value._memory._selectHandler.pointSelection.isSelected?"\u2713":"")},h=function(e){var t=e.arcArray,a=e.arcDispatch,n=r.a.useMemo((function(){return[{Header:"#",accessor:function(e,t){return t},width:15},{Header:"\u2713",accessor:"svgHandle",Cell:b,width:15},{Header:"Name",Cell:v,accessor:"name",width:100},{Header:"Type",Cell:v,accessor:"type",width:80},{Header:"Volume",Cell:v,accessor:"volume",width:60},{Header:"State",Cell:v,id:"initState",accessor:function(e){return JSON.stringify(e.initState).slice(1,-1)},width:240}]}),[]),c=r.a.useState(!1),o=Object(i.a)(c,2),l=o[0],d=o[1];return r.a.useEffect((function(){d(!1)}),[t]),r.a.createElement(p,{columns:n,data:t,updateMyData:function(e,n,r){if("Connections"!==n){if("volume"===n&&"valve"===t[e].type.toLowerCase()){var c=Object(u.a)(t[e].config);if(parseInt(r)>c.length)for(var o=c.length;o<parseInt(r);o++)c.push({id:c.length,text:"plugged"});else for(var i=c.length-1;i>=0&&c.length!==parseInt(r);i--)"plugged"===c[i].text&&c.splice(i,1);a([N,{id:t[e].id,field:"config",data:c}])}var l=r;"volume"===n&&(l=JSON.parse(l)),"initState"===n&&(l=JSON.parse("[".concat(l,"]"))),a([N,{id:t[e].id,field:n,data:l}])}},skipPageReset:l})},j=a(42),y=a(25),E=(a(37),a(43)),S=a(44),_={border:"1px solid lightgrey",padding:"0",marginBottom:"-1px",backgroundColor:"white",cursor:"move"},w=function(e){var t=e.id,a=e.text,c=e.index,o=e.moveCard,l=Object(n.useRef)(null),s=Object(E.a)({accept:"card",hover:function(e,t){var a;if(l.current){var n=e.index,r=c;if(n!==r){var i=null===(a=l.current)||void 0===a?void 0:a.getBoundingClientRect(),d=(i.bottom-i.top)/2,s=t.getClientOffset().y-i.top;n<r&&s<d||n>r&&s>d||(o(n,r),e.index=r)}}}}),u=Object(i.a)(s,2)[1],f=Object(S.a)({item:{type:"card",id:t,index:c},collect:function(e){return{isDragging:e.isDragging()}}}),v=Object(i.a)(f,2),p=v[0].isDragging?0:1;return(0,v[1])(u(l)),r.a.createElement("div",{ref:l,style:Object(d.a)(Object(d.a)({},_),{},{opacity:p})},a)},x=a(24),D=a.n(x),C={width:400},A=function(e){var t=e.arcs,a=e.ui,c=e.dispatch,o=a.focusArc[a.focusArc.length-1],l=Object(n.useState)(t[o]&&t[o].config?Object(u.a)(t[o].config):[]),d=Object(i.a)(l,2),s=d[0],f=d[1];Object(n.useEffect)((function(){f(t[o]&&t[o].config?Object(u.a)(t[o].config):[])}),[a,t,o]);var v=Object(n.useCallback)((function(e,t){var a=s[e],n=D()(s,{$splice:[[e,1],[t,0,a]]});f(n),c([N,{id:o,field:"config",data:n}])}),[s,c,o]);return r.a.createElement("div",{className:"draglist-container"},r.a.createElement("div",{className:"numbering-container"},s.map((function(e,t){return r.a.createElement("div",{className:"numbering-item"},t)}))),r.a.createElement("div",{style:C},s.map((function(e,t){return function(e,t){return r.a.createElement(w,{key:e.id,index:t,id:e.id,text:e.text,moveCard:v})}(e,t)}))))},I=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=[],c=Object(u.a)(e),o=0===a?1:0;if(c[o]<t[o]){for(;c[o]<t[o];)r.push(Object(u.a)(c)),c[0]+=a,c[1]+=n;return r}for(;c[o]>t[o];)r.push(Object(u.a)(c)),c[0]+=a,c[1]+=n;return r},R=function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},k=function(e){var t=0;return e.map((function(e){return t+=e}))},L=function(e,t,a){var n=Object.values(t.arcs).find((function(e){return"valve"===e.type.toLowerCase()&&"waste"===e.name.toLowerCase()})).id,r=function(e){var t,a=0,n=0,r=Object(s.a)(e.initState);try{for(r.s();!(t=r.n()).done;){var c=t.value;""!==c[0]?n+=c[1]:a+=c[1]}}catch(o){r.e(o)}finally{r.f()}e.initState=[],0!==n&&e.initState.push(["Bulk_Fluid",n]),0!==a&&e.initState.push(["RXX",a])},c=function(e){if(e)for(var a=function(e){for(var t=[],a=[],n=0;n<e.length;n++){var r=Object(i.a)(e[n],2),c=r[0];0!==r[1]?a.push.apply(a,Object(u.a)(c.initState)):a.push.apply(a,Object(u.a)(c.initState.reverse())),t.push(c.volume)}a.push(["RXX",1e7]);var o=k(t),l=k(a.map((function(e){return e[1]})));return[a,o,l,function(e,t){for(var a=0,n=0,r=0,c=[];a<e.length||n<t.length;)(n===t.length||e[a]<=t[n])&&(c[r-1]!==e[a]&&(c[r]=e[a],r+=1),a+=1),(a===e.length||t[n]<=e[a])&&(c[r-1]!==t[n]&&(c[r]=t[n],r+=1),n+=1);return c}(o,l)]}(e),n=Object(i.a)(a,4),c=n[0],o=n[1],l=n[2],d=n[3],s=0,f=0,v=0,p=[];v<o.length;){if(p.push([c[f][0],s>0?d[s]-d[s-1]:d[s]]),d[s]===l[f]&&(f+=1),d[s]===o[v]){if(p.length>1)for(var O=p.length-2;O>=0;O--)p[O][0]===p[O+1][0]&&(p[O][1]=p[O][1]+p[O+1][1],p.splice(O+1,1));0===e[v][1]&&(p=p.reverse()),t.arcs[e[v][0].id].initState=p,["pump","waste"].includes(t.arcs[e[v][0].id].type)&&r(t.arcs[e[v][0].id]),p=[],v+=1}s+=1}},o=function(e,t,a){if(0!==e.volume){for(var n,r,c,o=function(e){var t,a,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=[];for(n=0;n<e.length-1;n++){var o=R(e[n],e[n+1]);t=e[1+n][0]===e[n][0]?0:r*(e[n+1][0]-e[n][0])/o,a=e[1+n][1]===e[n][1]?0:r*(e[n+1][1]-e[n][1])/o,c.push.apply(c,Object(u.a)(I(e[n],e[n+1],t,a)))}return c.push(e[n]),c}(e.geom,10),l=function(e,t){for(var a,n=e.map((function(e){return e[1]})).reduce((function(e,t){return e+t}),0),r=[],c=[],o=0,i=0;i<e.length-1;i++)a=(a=Math.floor(e[i][1]/n*(t-e.length)))>0?a:1,c.push(Math.floor(o+a/2)),o+=a,r.push.apply(r,Object(u.a)(Array(a).fill(e[i][0])));return r.push.apply(r,Object(u.a)(Array(t-o).fill(e[i][0]))),c.push(Math.floor(o+(t-o)/2)),[r,c]}(e.initState,o.length-1),s=Object(i.a)(l,2),f=s[0],v=s[1],p=[0],O=0;O<f.length-1;O++)f[O]!==f[O+1]&&p.push(O+1);for(p.push(O+1),["supply","waste"].includes(e.type)?(n=1e3,r=10,c=3):"pump"===e.type?(n=1,r=10):(n=1,r=2),O=0;O<e.initState.length;O++)t.polyline(o.slice(p[O],p[O+1]+1)).stroke({width:r,color:d[e.initState[O][0]].color}).fill("none"),a&&a.polyline(o.slice(p[O],p[O+1]+1)).stroke({width:3,color:d[e.initState[O][0]].color}).fill("none");for(O=0;O<v.length;O++){var g;"supply"===e.type&&"RXX"===e.initState[O][0]||(g=t.text((e.initState[O][1]/n).toPrecision(c)).font({size:10})).move.apply(g,Object(u.a)(o[v[O]]))}}},l={Valve:function(e,a,n){!function(e){var a,n=t.ValvePortMapping[e],r=Object(s.a)(O);try{for(r.s();!(a=r.n()).done;){var c=Object(i.a)(a.value,2),o=c[0],l=c[1],d=t.arcs[l].config,u=t.arcs[l].connections[0];t.arcs[l].initState=[u[d[0].text]];var f=t.arcs[l].initState;if("rotary"===o)"plugged"!==d[n.Port].text&&f.push(u[d[n.Port].text]);else{var v="B"===n.ValvePositions[parseInt(o.slice(1))-1];2===d.length&&v?f.push(u[d[1].text]):3===d.length&&f.push(u[d[v?2:1].text])}}}catch(p){r.e(p)}finally{r.f()}}(e)},Pull:function(e,a,n){var r;r=parseInt(e),t.arcs[g].volume+=r;var l=function(e){for(var a=t.arcs[e],n=[[[a,1===t.nodes[a.geom[0]].arcs.length?a.geom.length-1:0]]];n.length;){var r=n.pop(),c=Object(i.a)(r[r.length-1],2),o=c[0],l=c[1],d=t.nodes[o.geom[l]],f=d.arcs;if(d.valveArc){var v=t.arcs[d.valveArc];f=v.initState.includes(o.id)&&2===v.initState.length?[v.initState[v.initState[0]===o.id?1:0]]:[]}var O,g=Object(s.a)(f);try{for(g.s();!(O=g.n()).done;){var m=O.value;if(m!==o.id){var b=t.arcs[m],h=t.nodes[b.geom[0]].arcs.includes(o.id)?b.geom.length-1:0;if(["supply","waste"].includes(b.type)||"sipper"===b.type&&!p)return[].concat(Object(u.a)(r),[[b,h]]);n.push([].concat(Object(u.a)(r),[[b,h]]))}}}catch(j){g.e(j)}finally{g.f()}}}(g);c(l),f.last().remove();var d=f.group();l.forEach((function(e){var t=Object(i.a)(e,2),a=t[0];t[1];if("valve"!==a.type){a.svgHandle.remove();var n=f.group();o(a,n,d),a.svgHandle=n}})),f.text((n+1).toString()).font({size:30}).move(930,470),a&&v.push(f.svg()),d.remove()},Dispense:function(e,a,r){var c=n,o=t.arcs[c].config,i=t.arcs[c].connections[0];t.arcs[c].initState=[i[o[0].text],i[o[2].text]],l.Pull(-t.arcs[g].volume,a,r),t.arcs[c].initState=[i[o[0].text],i[o[1].text]]},ElevatorDown:function(){return p=!1},ElevatorUp:function(){return p=!0},Wait:function(){}};window.drawState=o;var d=t.reagents,f=a.group(),v=[],p=!0,O=[];Object.values(t.arcs).filter((function(e){return"valve"===e.type.toLowerCase()})).forEach((function(e){return O.push([e.name,e.id])}));var g=Object.values(t.arcs).find((function(e){return"pump"===e.type.toLowerCase()})).id;Object.values(t.arcs).forEach((function(e){if("valve"!==e.type.toLowerCase()){e.svgHandle&&e.svgHandle.remove();var t,a,n=f.group();if(o(e,n),e.svgHandle=n,"supply"===e.type.toLowerCase()&&"RXX"!==e.name.toLowerCase())(t=(a=f.text(e.name).font({size:10})).move.apply(a,Object(u.a)(e.geom[0]))).rotate.apply(t,[90].concat(Object(u.a)(e.geom[0]))).dmove(0,-5)}})),f.text("Initial").font({size:30}).move(930,470),v.push(f.svg());for(var m=0;m<e.length;){var b=e[m].split(/\s+/);if(0!==b.length)if("LoopStart"!==b[0])l[b[0]]&&l[b[0]](b[1],!0,m),m+=1;else{for(var h=!1,j=0;!h&&m+j+1<e.length;){"LoopEnd"===e[m+(j+=1)].split(/\s+/)[0]&&(h=!0)}for(var y=0;y<parseInt(b[1]);y++)for(var E=m+1;E<m+j+1;E++){var S=e[E].split(/\s+/);0===y?l[S[0]]&&l[S[0]](S[1],!0,m):l[S[0]]&&l[S[0]](S[1],!1,m)}m=m+j+1}}return v},N="EDIT_ARC_PARAMS",M=function(e){return{id:e.attr().id,type:"valve",name:e.attr().id,geom:[[e.attr().cx,e.attr().cy]],volume:3,initState:[],connections:[{}],config:Object(u.a)(Array(3).keys()).map((function(e){return{id:e,text:"plugged"}})),svgHandle:e}},T=function(e,t,a){var n,r=e.arcs,c=e.nodes,o=Object(s.a)(c[t].arcs);try{var i=function(){var e=n.value;if(e===a)return"continue";var o=void 0;o="valve"===(r=Object(d.a)(Object(d.a)({},r),{},Object(l.a)({},e,Object(d.a)(Object(d.a)({},r[e]),{},{connections:Object(u.a)(r[e].connections)}))))[e].type||t.toString()===r[e].geom[0].toString()?0:1;var i={};if(c[t].arcs.filter((function(t){return t!==e})).forEach((function(e){return Object.assign(i,Object(l.a)({},r[e].name,e))})),r[e].connections[o]=i,"valve"===r[e].type){for(var s=Object(u.a)(r[e].config),f=0;f<s.length;f++)"plugged"!==s[f].text&&(Object.keys(r[e].connections[o]).includes(s[f].text)||(s.splice(f,1,{text:"plugged",id:99}),s=s.map((function(e,t){return{text:e.text,id:t}}))));for(var v=s.map((function(e){return e.text})).filter((function(e){return"plugged"!==e})),p=s.filter((function(e){return"plugged"===e.text})),O=0,g=Object.keys(r[e].connections[o]);O<g.length;O++){var m=g[O];if(!v.includes(m)){var b=p.shift().id;s.splice(b,1,{id:b,text:m})}}r[e].config=s}};for(o.s();!(n=o.n()).done;)i()}catch(f){o.e(f)}finally{o.f()}return r},H=function(e,t){var a,n,r=Object(i.a)(t,2),c=r[0],o=r[1];switch(c){case"INIT_LINE":return Object(d.a)(Object(d.a)({},e),{},{arcs:Object(d.a)(Object(d.a)({},e.arcs),{},Object(l.a)({},o.node.id,(n=o,{id:n.node.id,type:"line",svgHandle:n,name:n.node.id,geom:n.array().valueOf(),volume:90,initState:[["RXX",90]],connections:[{},{}]})))});case"INIT_VALVE":return Object(d.a)(Object(d.a)({},e),{},{arcs:Object(d.a)(Object(d.a)({},e.arcs),{},Object(l.a)({},o.attr().id,M(o)))});case"DEL_ARC":return delete(a=Object(d.a)(Object(d.a)({},e),{},{arcs:Object(d.a)({},e.arcs)})).arcs[o],a;case"EDIT_ARC_GEOM":return Object(d.a)(Object(d.a)({},e),{},{arcs:Object(d.a)(Object(d.a)({},e.arcs),{},Object(l.a)({},o.arcId,Object(d.a)(Object(d.a)({},e.arcs[o.arcId]),{},{geom:o.geom})))});case N:if(a=Object(d.a)(Object(d.a)({},e),{},{arcs:Object(d.a)(Object(d.a)({},e.arcs),{},Object(l.a)({},o.id,Object(d.a)(Object(d.a)({},e.arcs[o.id]),{},Object(l.a)({},o.field,o.data))))}),"name"===o.field)("valve"===a.arcs[o.id].type?[0]:[0,a.arcs[o.id].geom.length-1]).forEach((function(e){a.arcs=T(a,a.arcs[o.id].geom[e],o.id)}));return a;case"REC_POLYS":return Object(d.a)(Object(d.a)({},o),{},{ui:{focusArc:[]}});case"REC_ARCS":return Object(d.a)(Object(d.a)({},e),{},{arcs:o});case"ADD_TO_NODE":return(a=o.coord in e.nodes?Object(d.a)(Object(d.a)({},e),{},{nodes:Object(d.a)(Object(d.a)({},e.nodes),{},Object(l.a)({},o.coord,Object(d.a)(Object(d.a)({},e.nodes[o.coord]),{},{arcs:[].concat(Object(u.a)(e.nodes[o.coord].arcs),[o.arcId]),valveArc:"valve"===e.arcs[o.arcId].type?o.arcId:e.nodes[o.coord].valveArc})))}):Object(d.a)(Object(d.a)({},e),{},{nodes:Object(d.a)(Object(d.a)({},e.nodes),{},Object(l.a)({},o.coord,{id:o.coord,arcs:[o.arcId],valveArc:"valve"===e.arcs[o.arcId].type?o.arcId:null}))})).arcs=T(a,o.coord),a;case"DEL_FROM_NODE":var s=(a=Object(d.a)(Object(d.a)({},e),{},{nodes:Object(d.a)(Object(d.a)({},e.nodes),{},Object(l.a)({},o.coord,Object(d.a)(Object(d.a)({},e.nodes[o.coord]),{},{arcs:Object(u.a)(e.nodes[o.coord].arcs),valveArc:"valve"===e.arcs[o.arcId].type?null:e.nodes[o.coord].valveArc})))})).nodes[o.coord].arcs.indexOf(o.arcId);return a.nodes[o.coord].arcs.splice(s,1),a.arcs=T(a,o.coord),0===a.nodes[o.coord].arcs.length?(delete a.nodes[o.coord],a):a;case"ADD_FOCUS_ARC":return Object(d.a)(Object(d.a)({},e),{},{ui:Object(d.a)(Object(d.a)({},e.ui),{},{focusArc:[].concat(Object(u.a)(e.ui.focusArc),[o])})});case"DEL_FOCUS_ARC":var f=(a=Object(u.a)(e.ui.focusArc)).indexOf(o);return a.splice(f,1),Object(d.a)(Object(d.a)({},e),{},{ui:Object(d.a)(Object(d.a)({},e.ui),{},{focusArc:a})});case"CLEAR_FOCUS_ARC":return Object(d.a)(Object(d.a)({},e),{},{ui:Object(d.a)(Object(d.a)({},e.ui),{},{focusArc:[]})});default:return e}},F=function(){var e=Object(n.useReducer)(H,{arcs:{},nodes:{},ui:{focusArc:[]}}),t=Object(i.a)(e,2),a=t[0],c=t[1],o=Object(n.useReducer)((function(e){return e+1}),0),l=Object(i.a)(o,2),d=(l[0],l[1]),f=Object(n.useState)(!1),v=Object(i.a)(f,2),p=v[0],b=v[1],E=Object(n.useState)(""),S=Object(i.a)(E,2),_=S[0],w=S[1],x=Object(n.useState)(""),D=Object(i.a)(x,2),C=D[0],I=D[1],R=Object(n.useState)(""),k=Object(i.a)(R,2),M=(k[0],k[1]);function T(e){if(2===e.button){m.x=e.clientX-(g.x-window.pageXOffset),m.y=e.clientY-(g.y-window.pageYOffset);for(var t=m.matrixTransform(O.node.getScreenCTM().inverse()),a=this.array().valueOf(),n={},r={},o=0;o<a.length-1;o++){n.x=a[o][0],n.y=a[o][1],r.x=a[o+1][0],r.y=a[o+1][1];var i=(t.y-n.y)*(r.x-n.x)-(t.x-n.x)*(r.y-n.y),l=(t.x-n.x)*(r.x-n.x)+(t.y-n.y)*(r.y-n.y),d=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y);if(!(Math.abs(i)/Math.sqrt(d)>2)&&(!(l<0)&&!(l>d))){a.splice(o+1,0,[t.x,t.y]),this.plot(a),c(["EDIT_ARC_GEOM",{arcId:this.node.id,geom:a}]),this.selectize(!1,{deepSelect:!0}),this.selectize({deepSelect:!0});break}}}}function F(e){if(2===e.detail.event.button){var t=this.array().valueOf(),a=t.length-1,n=t[e.detail.i];t.splice(e.detail.i,1),this.plot(t),c(["EDIT_ARC_GEOM",{arcId:this.node.id,geom:t}]),0===e.detail.i?(c(["DEL_FROM_NODE",{arcId:this.node.id,coord:n}]),c(["ADD_TO_NODE",{arcId:this.node.id,coord:t[0]}])):e.detail.i===a&&(c(["DEL_FROM_NODE",{arcId:this.node.id,coord:n}]),c(["ADD_TO_NODE",{arcId:this.node.id,coord:t[a-1]}])),this.selectize(!1,{deepSelect:!0}),this.selectize({deepSelect:!0})}}Object(n.useEffect)((function(){p&&Y(p)}),[p]),Object(n.useEffect)((function(){document.getElementById("canvas").addEventListener("contextmenu",(function(e){e.preventDefault()})),O=window.SVG("canvas").size("100%","100%").panZoom({zoomFactor:.1,zoomMin:.5,zoomMax:3});var e=document.getElementById("fileSelect"),t=document.getElementById("import");e.addEventListener("click",(function(e){t&&t.click()}),!1),document.getElementById("exampleDiag").addEventListener("click",V);var a=document.getElementById("scriptSelect"),n=document.getElementById("importScript");a.addEventListener("click",(function(e){n&&n.click()}),!1),document.addEventListener("keydown",(function(e){if("Escape"===e.key){var t,a=Object(s.a)(O.children());try{for(a.s();!(t=a.n()).done;){var n=t.value;n._memory&&n._memory._selectHandler&&n._memory._selectHandler.pointSelection.isSelected&&n.fire("dblclick",{noDispatch:!0})}}catch(l){a.e(l)}finally{a.f()}c(["CLEAR_FOCUS_ARC"]),d()}else if(8===e.keyCode){var r,o=Object(s.a)(O.children());try{for(o.s();!(r=o.n()).done;){var i=r.value;i._memory&&i._memory._selectHandler&&i._memory._selectHandler.pointSelection.isSelected&&(i.fire("dblclick",{noDispatch:!0}),"circle"!==i.type?(c(["DEL_FROM_NODE",{arcId:i.node.id,coord:i.array().valueOf()[0]}]),c(["DEL_FROM_NODE",{arcId:i.node.id,coord:i.array().valueOf()[i.array().valueOf().length-1]}])):c(["DEL_FROM_NODE",{arcId:i.node.id,coord:[i.attr().cx,i.attr().cy]}]),c(["DEL_ARC",i.node.id]),i.remove())}}catch(l){o.e(l)}finally{o.f()}}})),O.node.getScreenCTM().inverse(),g={x:window.pageXOffset,y:window.pageYOffset},m=O.node.createSVGPoint(),window.drawing=O}),[]);var P=function(e,t){e.attr("stroke-width",1).attr("fill","none").addClass("hover_line").on("dblclick",(function(a){void 0!==e._memory&&void 0!==e._memory._selectHandler&&e._memory._selectHandler.pointSelection.isSelected?(e.stroke({color:"black"}).selectize(!1,{deepSelect:!0}).off("mousedown").off("point").off("dragEnd").off("dragStart"),a.detail&&a.detail.noDispatch||t(["DEL_FOCUS_ARC",e.node.id])):(e.stroke({color:"red"}).selectize({deepSelect:!0}).on("mousedown",T.bind(e)).on("point",F.bind(e)).on("dragStart",(function(a){var n=e.array().valueOf();t(["DEL_FROM_NODE",{arcId:e.node.id,coord:n[a.detail.pos]}])})).on("dragEnd",(function(a){var n=e.array().valueOf();t(["EDIT_ARC_GEOM",{arcId:e.node.id,geom:n}]),0!==a.detail.pos&&a.detail.pos!==n.length-1||t(["ADD_TO_NODE",{arcId:e.node.id,coord:n[a.detail.pos]}])})),t(["ADD_FOCUS_ARC",e.node.id])),a.detail&&a.detail.noDispatch||t([N,{id:e.node.id,field:"svgHandle",data:e}])}))},z=function(e,t){e.fill("white").stroke({width:1,color:"red"}).back().on("dblclick",(function(a){void 0!==e._memory&&void 0!==e._memory._selectHandler&&e._memory._selectHandler.pointSelection.isSelected?(e.radius(3).stroke({width:1,color:"red"}).selectize(!1).draggable(!1).off("dragstart").off("dragend"),a.detail&&a.detail.noDispatch||t(["DEL_FOCUS_ARC",e.node.id])):(e.radius(4).stroke({width:2,color:"green"}).selectize().draggable({snapToGrid:10}).on("dragstart",(function(a){t(["DEL_FROM_NODE",{arcId:e.attr().id,coord:[e.attr().cx,e.attr().cy]}])})).on("dragend",(function(a){var n=[e.attr().cx,e.attr().cy];t(["EDIT_ARC_GEOM",{arcId:e.node.id,geom:[n]}]),t(["ADD_TO_NODE",{arcId:e.attr().id,coord:n}])})),t(["ADD_FOCUS_ARC",e.node.id])),a.detail&&a.detail.noDispatch||t([N,{id:e.node.id,field:"svgHandle",data:e}])}))},B=function(e){var t,n=e.target;console.log(n);var r=function(e){t.id("l_"+(new Date).getUTCMilliseconds().toString(36)),t.draw("done"),t.off("drawstart"),c(["INIT_LINE",t]);var a=t.array().valueOf();c(["ADD_TO_NODE",{arcId:t.node.id,coord:a[0]}]),c(["ADD_TO_NODE",{arcId:t.node.id,coord:a[a.length-1]}])};if("valve"===n.value)O.on("mousedown",(function(e){m.x=e.clientX-(g.x-window.pageXOffset),m.y=e.clientY-(g.y-window.pageYOffset);var a,n=m.matrixTransform(O.node.getScreenCTM().inverse());for(var r in n)a=n[r]%10,n[r]-=(a<5?a:a-10)+(a<0?10:0);t=O.circle(6).id("v_"+(new Date).getUTCMilliseconds().toString(36)).center(n.x,n.y),z(t,c),O.off("mousedown"),c(["INIT_VALVE",t]),c(["ADD_TO_NODE",{arcId:t.attr().id,coord:[t.attr().cx,t.attr().cy]}])}));else if("line"===n.value)(t=O.polyline()).draw({snapToGrid:10}),P(t,c),t.on("drawstart",(function(){return document.addEventListener("keydown",r)})),t.on("drawstop",(function(){return document.removeEventListener("keydown",r)}));else if("export"===n.value){var o=new Blob([JSON.stringify(a,(function(e,t){if("svgHandle"!==e)return t}),2)],{type:"application/json"}),i=window.URL.createObjectURL(o),l=document.createElement("a");l.setAttribute("href",i),l.setAttribute("download","export.json"),l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l)}n.blur()},X=new FileReader;X.onload=function(e){return U(e.target.result)};var U=function(e){for(var t=JSON.parse(e),a=0,n=Object.entries(t.arcs);a<n.length;a++){var r,o=Object(i.a)(n[a],2),l=o[0],d=o[1],s=void 0;if("valve"!==d.type)s=O.polyline(d.geom).id(l),P(s,c);else s=(r=O.circle(6)).center.apply(r,Object(u.a)(d.geom[0])).id(l),z(s,c);t.arcs[l].svgHandle=s}c(["REC_POLYS",t])},V=function(e){O.clear(),fetch("config.json").then((function(e){return e.text()})).then((function(e){I(e),U(e)})).then((function(){G()}))},G=function(e){fetch("script.txt").then((function(e){return e.text()})).then((function(e){b(e)}))},J=new FileReader;J.onload=function(e){return Y(e.target.result)};var Y=function(e){de(!1);var t=JSON.parse(JSON.stringify(a,(function(e,t){if("svgHandle"!==e)return t})));Z(L(e.split("\n"),t,O))},W=Object(n.useState)([]),q=Object(i.a)(W,2),$=q[0],Z=q[1];window.xxx=$,window.runScript=function(){Z(L(a,O))};var K=Object(n.useState)(50),Q=Object(i.a)(K,2),ee=Q[0],te=Q[1],ae=Object(n.useState)(!0),ne=Object(i.a)(ae,2),re=ne[0],ce=ne[1],oe=Object(n.useState)(!0),ie=Object(i.a)(oe,2),le=ie[0],de=ie[1];return r.a.createElement("div",{className:"app-container"},r.a.createElement("div",{className:"canvas-container"},r.a.createElement("div",{className:"btn-group",id:"area"},r.a.createElement("button",{id:"button1",value:"line",title:"Add Line",onClick:B},"Add Line"),r.a.createElement("button",{id:"button0",value:"valve",title:"Add Valve",onClick:B},"Add Valve"),r.a.createElement("button",{id:"button4",value:"export",title:"Download Configuration",onClick:B},"Save Config"),r.a.createElement("button",{id:"fileSelect"},"Load Diagram"),r.a.createElement("input",{type:"file",id:"import",onChange:function(e){w(e.target.files),O.clear(),X.readAsText(e.target.files[0])}}),r.a.createElement("button",{id:"scriptSelect"},"Load Script"),r.a.createElement("input",{type:"file",id:"importScript",onChange:function(e){M(e.target.files),J.readAsText(e.target.files[0])}}),r.a.createElement("button",{id:"exampleDiag"},"Load Example Diagram & Script"),r.a.createElement("button",{id:"button5",title:"reload",onClick:function(){le?O.svg($[document.getElementById("range").value]):(O.clear(),_[0]?X.readAsText(_[0]):U(C)),de((function(e){return!e}))}},"Toggle Edit/View"),r.a.createElement("button",{id:"button6",title:"reload",onClick:function(){return ce((function(e){return!e}))}},"Toggle Sidebar")),r.a.createElement("div",{id:"canvas"}),r.a.createElement("input",{id:"range",type:"range",min:"0",max:$.length,value:ee,step:"1",onChange:function(e){te(e.target.value),O.last().clear(),O.svg($[e.target.value])}})),re&&r.a.createElement("div",{className:"sidebar"},r.a.createElement(h,{arcArray:Object.values(a.arcs),arcDispatch:c}),r.a.createElement(j.a,{backend:y.a},r.a.createElement(A,{arcs:a.arcs,dispatch:c,ui:a.ui}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(F,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[28,1,2]]]);
//# sourceMappingURL=main.c87add0e.chunk.js.map